<?xml version="1.0" encoding="UTF-8"?>

<!-- $Revision: 1.21 $ $Date: 2004-10-27 20:54:09 +0600 (Wed, 27 Oct 2004) $ -->

<project default="jar"
    xmlns:j="jelly:core"
    xmlns:u="jelly:util"
    xmlns:maven="jelly:maven"
    xmlns:deploy="deploy"
    xmlns:ant="jelly:ant">
    <j:set var="samples.dir" value="target/samples"/>

    <postGoal name="test:test">
      <j:if test="${context.getVariable('maven.test.skip') != 'true'}">
        <attainGoal name="create-samples"/>
      </j:if>
    </postGoal>
    
    <goal name="mail-tests">
      <!--       TODO call the Mail tests if the mail jar is presents
        <j:if test="${maven.repo.local}/j2ee/jars/mail.jar"> 
            <ant:ant antfile="script/mail-test.xml" inheritall="true" inheritrefs="true" dir="."/>
         </j:if> 
         maven -Dtestcase=org.foo.bar.MyTest test:single-test
         -->
    </goal>

    <goal name="create-samples">
<!--        <mkdir dir="target/samples"/>-->
        <mkdir dir="${samples.dir}/userguide"/>
        <mkdir dir="target/samples/wsdl"/>
        <copy todir="target/samples/wsdl">
            <ant:fileset dir="wsdl"/>
        </copy>
        <attainGoal name="userguide"/>
        <attainGoal name="amazonQS"/>
        <attainGoal name="googleSearch"/>
        <attainGoal name="googleSpellcheck"/>
        <attainGoal name="version"/>
        <attainGoal name="mtomSample"/>
        <attainGoal name="groovy"/>
        <attainGoal name="securitySample"/>
      <attainGoal name="sgccalculator"/>
    </goal>

    <!-- ================================================================ -->
    <!--- Version Sample -->
    <!-- ================================================================ -->
    <goal name="version">
        <mkdir dir="target/samples"/>
        <mkdir dir="${samples.dir}/version"/>
        <mkdir dir="${samples.dir}/version/src"/>
        <ant:copy todir="${samples.dir}/version/src">
            <ant:fileset dir="src">
                <ant:include name="sample/axisversion/**"/>
            </ant:fileset>
        </ant:copy>
        <jar destfile="${samples.dir}/version/version.jar">
            <fileset dir="target/classes">
                <include name="sample/axisversion/**"/>
            </fileset>
            <fileset dir="src/sample/axisversion/">
                <include name="META-INF/**"/>
            </fileset>
        </jar>
        <copy file="${samples.dir}/version/version.jar"
            tofile="target/toWar/services/version.aar"/>
    </goal>
    <!-- ================================================================ -->
    <!--- User Guide Sample -->
    <!-- ================================================================ -->


    <goal name="userguide">
        <mkdir dir="target/samples"/>
        <mkdir dir="${samples.dir}/userguide"/>
        <mkdir dir="${samples.dir}/userguide/src"/>
        <ant:copy todir="${samples.dir}/userguide/src">
            <ant:fileset dir="src">
                <ant:include name="userguide/**"/>
            </ant:fileset>
        </ant:copy>
        <jar destfile="${samples.dir}/userguide/sample.jar">
            <fileset dir="target/classes">
                <include name="userguide/**"/>
            </fileset>
        </jar>
        <jar destfile="${samples.dir}/userguide/MyService.aar">
            <fileset dir="src/userguide/example1/">
                <include name="META-INF/**"/>
            </fileset>
            <fileset dir="target/classes">
                <include name="userguide/example1/**/*.class"/>
            </fileset>
        </jar>
        <jar destfile="${samples.dir}/userguide/MyServiceWithModule.aar">
            <fileset dir="src/userguide/example2/">
                <include name="META-INF/**"/>
            </fileset>
            <fileset dir="target/classes">
                <include name="userguide/example2/**/*.class"/>
            </fileset>
        </jar>
        <jar destfile="${samples.dir}/userguide/WsaMappingService.aar">
            <fileset dir="src/userguide/example3/">
                <include name="META-INF/**"/>
            </fileset>
            <fileset dir="target/classes">
                <include name="userguide/example3/**/*.class"/>
            </fileset>
        </jar>

        <jar destfile="${samples.dir}/userguide/LoggingModule.mar">
            <fileset dir="src/userguide/loggingmodule/">
                <include name="META-INF/**"/>
            </fileset>
            <fileset dir="target/classes">
                <include name="userguide/loggingmodule/**/*.class"/>
            </fileset>
        </jar>
    <ant:copy file="script/userguide/build.xml" tofile="target/samples/userguide/build.xml"/>

    </goal>
    <!-- ================================================================ -->
    <!--- Amazon Qaueing Service Sample -->
    <!-- ================================================================ -->

    <goal name="amazonQS">
        <mkdir dir="${samples.dir}/amazonQS"/>
        <mkdir dir="${samples.dir}/amazonQS/src"/>
        <ant:copy todir="${samples.dir}/amazonQS/src">
            <ant:fileset dir="src">
                <ant:include name="sample/amazon/amazonSimpleQueueService/**"/>
                <ant:include name="sample/amazon/common/**"/>
            </ant:fileset>
        </ant:copy>
        <mkdir dir="${samples.dir}/amazonQS/docs"/>
        <ant:copy todir="${samples.dir}/amazonQS/docs">
            <ant:fileset dir="xdocs/amazonQS"/>
        </ant:copy>
        <ant:copy file="xdocs/readme.txt" tofile="${samples.dir}/amazonQS/readme.txt"/>
        <ant:copy todir="${samples.dir}/amazonQS">
            <ant:fileset dir="script/amazonQS"/>
        </ant:copy>
        <jar destfile="${samples.dir}/amazonQS/amazonQS.jar">
            <fileset dir="target/classes">
                <include name="sample/amazon/amazonSimpleQueueService/**"/>
                <include name="sample/amazon/common/**"/>
            </fileset>
        </jar>
    </goal>


    <!-- ================================================================ -->
    <!--- Google Search Sample -->
    <!-- ================================================================ -->

    <goal name="googleSearch">
        <mkdir dir="${samples.dir}/googleSearch"/>
        <mkdir dir="${samples.dir}/googleSearch/src"/>
        <ant:copy todir="${samples.dir}/googleSearch/src">
            <ant:fileset dir="src">
                <ant:include name="sample/google/search/**"/>
                <ant:include name="sample/google/common/**"/>
            </ant:fileset>
        </ant:copy>
        <mkdir dir="${samples.dir}/googleSearch/docs"/>
        <ant:copy todir="${samples.dir}/googleSearch/docs">
            <ant:fileset dir="xdocs/googleSearch"/>
        </ant:copy>
        <ant:copy file="xdocs/readme.txt" tofile="${samples.dir}/googleSearch/readme.txt"/>
        <ant:copy todir="${samples.dir}/googleSearch">
            <ant:fileset dir="script/googleSearch"/>
        </ant:copy>
        <jar destfile="${samples.dir}/googleSearch/googleSearch.jar">
            <fileset dir="target/classes">
                <include name="sample/google/search/**"/>
                <include name="sample/google/common/**"/>
            </fileset>
        </jar>
    </goal>
    <!-- ================================================================ -->
    <!--- Google SpellCheck Sample -->
    <!-- ================================================================ -->

    <goal name="googleSpellcheck">
        <mkdir dir="${samples.dir}/googleSpellcheck"/>
        <mkdir dir="${samples.dir}/googleSpellcheck/src"/>
        <ant:copy todir="${samples.dir}/googleSpellcheck/src">
            <ant:fileset dir="src">
                <ant:include name="sample/google/spellcheck/**"/>
                <ant:include name="sample/google/common/**"/>
            </ant:fileset>
        </ant:copy>
        <mkdir dir="${samples.dir}/googleSpellcheck/docs"/>
        <ant:copy todir="${samples.dir}/googleSpellcheck/docs">
            <ant:fileset dir="xdocs/googleSpellcheck"/>
        </ant:copy>
        <ant:copy file="xdocs/readme.txt" tofile="${samples.dir}/googleSpellcheck/readme.txt"/>
        <ant:copy todir="${samples.dir}/googleSpellcheck">
            <ant:fileset dir="script/googleSpellcheck"/>
        </ant:copy>
        <jar destfile="${samples.dir}/googleSpellcheck/googleSpellcheck.jar">
            <fileset dir="target/classes">
                <include name="sample/google/spellcheck/**"/>
                <include name="sample/google/common/**"/>
            </fileset>
        </jar>
    </goal>

    <!-- ================================================================ -->
    <!--- Google MTOM Sample -->
    <!-- ================================================================ -->

    <goal name="mtomSample">
        <mkdir dir="${samples.dir}/mtom"/>
        <mkdir dir="${samples.dir}/mtom/src"/>
        <ant:copy todir="${samples.dir}/mtom/src">
            <ant:fileset dir="src">
                <ant:include name="sample/mtom/**"/>
            </ant:fileset>
        </ant:copy>
        <ant:copy todir="${samples.dir}/mtom">
            <ant:fileset dir="script/mtomSample"/>
        </ant:copy>
        <jar destfile="${samples.dir}/mtom/mtomSample.aar">
            <fileset dir="src/sample/mtom/imagetransfer/service/">
                <include name="META-INF/**"/>
            </fileset>
            <fileset dir="target/classes">
                <include name="sample/mtom/imagetransfer/service/**/*.class"/>
            </fileset>
        </jar>
        <jar destfile="${samples.dir}/mtom/mtomClient.jar">
            <fileset dir="target/classes">
                <include name="sample/mtom/imagetransfer/client/**/*.class"/>
            </fileset>
        </jar>
    </goal>
    
    <!-- ================================================================ -->
    <!--- Groovy Service Sample -->
    <!-- ================================================================ -->

    <goal name="groovy">
        <mkdir dir="target/samples"/>
        <ant:copy file="./src/sample/groovy/GroovyRcv.groovy" tofile="target/classes/sample/groovy/GroovyRcv.groovy"/>
        <mkdir dir="target/classes/sample/groovy/lib"/>
        <mkdir dir="target/classes/sample/groovy/sample"/>
        <mkdir dir="target/classes/sample/groovy/sample/groovy"/>
        <ant:copy file="target/classes/sample/groovy/GroovyReceiver.class" tofile="target/classes/sample/groovy/sample/groovy/GroovyReceiver.class"/>
        <ant:delete file="target/classes/sample/groovy/GroovyReceiver.class"/>
        <ant:copy file="${maven.repo.local}/groovy/jars/groovy-all-1.0-jsr-01.jar" tofile="target/classes/sample/groovy/lib/groovy-all-1.0-jsr-01.jar"/>
        <jar destfile="${samples.dir}/groovyService.aar">
            <fileset dir="target/classes/sample/groovy">
            </fileset>
        </jar>
    </goal>

    <!-- ================================================================ -->
    <!--- Security Sample -->
    <!-- ================================================================ -->
    <goal name="securitySample">

    <mkdir dir="target/security"/>
    <mkdir dir="target/security/META-INF"/>
    
        <!-- Create the service archive -->
        <ant:move todir="target/security">
         <ant:fileset dir="target/classes">
                <ant:include name="sample/security/*.class"/>
            </ant:fileset>
    </ant:move>
    <ant:copy file="src/sample/security/META-INF/services.xml" tofile="target/security/META-INF/services.xml"/>
    <ant:copy file="resources/security/sec.jks" tofile="target/security/sec.jks"/>
    <ant:copy file="resources/security/sec.properties" tofile="target/security/sec.properties"/>
        <jar destfile="target/security/SecureService.aar">
            <fileset dir="target/security"></fileset>
        </jar>
        
    <!-- Create a jar to hold the password callback class-->
    <mkdir dir="target/security/secUtil/sample/security/" />
    <ant:copy file="target/security/sample/security/PWCallback.class" toFile="target/security/secUtil/sample/security/PWCallback.class" />
    <ant:copy file="target/security/sample/security/Client.class" toFile="target/security/secUtil/sample/security/Client.class" />
    <ant:copy file="resources/security/sec.jks" tofile="target/security/secUtil/sec.jks"/>
    <ant:copy file="resources/security/sec.properties" tofile="target/security/secUtil/sec.properties"/>
        <jar destfile="target/security/secUtil.jar">
            <fileset dir="target/security/secUtil"></fileset>
        </jar>

    <mkdir dir="target/security/client_repo"/>
    <mkdir dir="target/security/client_repo/modules"/>

    <ant:copy file="../addressing/target/modules/addressing.mar" tofile="target/toWar/modules/addressing.mar"/>

    <!-- Copy the sources and others orver to the target/samples/security-->
    <mkdir dir="target/samples/security/src/sample/security/"/>
        <ant:copy todir="target/samples/security/src/sample/security/">
         <ant:fileset dir="src/sample/security" />
    </ant:copy>
    <mkdir dir="target/security/client_repo/modules"/>
    <ant:copy file="../addressing/target/modules/addressing.mar" tofile="target/samples/security/client_repo/modules/addressing.mar"/>
    <ant:copy file="resources/security/client.axis2.xml" tofile="target/samples/security/client_repo/axis2.xml"/>
    <ant:copy file="target/security/SecureService.aar" tofile="target/samples/security/SecureService.aar"/>
    <ant:copy file="target/security/secUtil.jar" tofile="target/samples/security/secUtil.jar"/>
    <ant:copy file="resources/security/README.txt" tofile="target/samples/security/README.txt"/>
    <ant:copy file="resources/security/build.xml" tofile="target/samples/security/build.xml"/>

    <delete dir="target/security/"/>

    </goal>

    <!-- ================================================================ -->
    <!--- ServiceGroupContext Calculator Sample -->
    <!-- ================================================================ -->
    <goal name="sgccalculator">
        <mkdir dir="target/samples"/>
        <mkdir dir="${samples.dir}/SGCCalculator"/>
        <mkdir dir="${samples.dir}/SGCCalculator/src"/>
        <ant:copy todir="${samples.dir}/SGCCalculator/src">
            <ant:fileset dir="src">
                <ant:include name="sample/sgccalculator/**"/>
            </ant:fileset>
        </ant:copy>
        <jar destfile="${samples.dir}/SGCCalculator/SGCCalculator.jar">
            <fileset dir="target/classes">
                <include name="sample/sgccalculator/**"/>
            </fileset>
            <fileset dir="src/sample/sgccalculator/">
                <include name="META-INF/**"/>
            </fileset>
        </jar>
      <copy toDir="${samples.dir}/SGCCalculator"
            file="script/SGCCalculator/run.bat"/>
        <copy toDir="${samples.dir}/SGCCalculator"
            file="script/SGCCalculator/run.sh"/>
    </goal>

    <preGoal name="itest:compile">
        <u:file var="file" name="${maven.itest.src}"/>
        <j:if test="${!file.exists()}">
            <j:expr value="${context.setVariable('maven.itest.skip', 'true')}"/>
        </j:if>
    </preGoal>
</project>

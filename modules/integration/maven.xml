<?xml version="1.0" encoding="UTF-8"?>

<!-- $Revision: 1.21 $ $Date: 2004-10-27 20:54:09 +0600 (Wed, 27 Oct 2004) $ -->

<project default="jar"
         xmlns:j="jelly:core"
         xmlns:u="jelly:util"
         xmlns:maven="jelly:maven"	
         xmlns:deploy="deploy"
         xmlns:ant="jelly:ant">
    <j:set var="samples.dir" value="target/samples"/>

    <postGoal name="itest:compile">
        <mkdir dir="target/itest-classes/modules"/>
        <copy file="../addressing/target/addressing-${addressing_version}.mar"
              tofile="target/itest-classes/modules/addressing-${addressing_version}.mar"/>
    </postGoal>

    <preGoal name="test:compile">

		<!-- Set a property that can be picked up from the ant build.xml's -->
		<ant:property name="maven.class.path" refid="maven.dependency.classpath"/>

		<!-- copy the mars so that they are available on the test classpath -->
		<copy file="../addressing/target/addressing-${addressing_version}.mar"
			  tofile="target/test-classes/modules/addressing-${addressing_version}.mar"/>
		
		<j:set var="axis2.home" value="${basedir}/target"/>

        <!-- compiling some custom wsdl files -->
        <j:set var="wsdl.source.dir" value="test-resources/wsdl"/>
        <j:set var="wsdl.output.base.dir" value="target/wsdl"/>
        <!-- make the dirs -->
        <mkdir dir="${wsdl.output.base.dir}"/>

        <ant:echo>Compiling DocumentUnwrappingTest.wsdl </ant:echo>
        <mkdir dir="${wsdl.output.base.dir}/documentunwrapping"/>
        <java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
            <jvmarg line="${maven.junit.jvmargs}"/>
            <classpath refid="maven.dependency.classpath"/>
            <classpath location="${compiled.classes.dir}"/>
            <arg line="-o target/wsdl/documentunwrapping -ss -sd -ssi -u  -g -uw -uri test-resources/wsdl/DocumentUnwrappingTest.wsdl"/>
        </java>
        <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/wsdl/documentunwrapping"/>

        <ant:echo>Compiling RPCUnwrappingTest.wsdl </ant:echo>
        <mkdir dir="${wsdl.output.base.dir}/rpcunwrapping"/>
        <java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
            <jvmarg line="${maven.junit.jvmargs}"/>
            <classpath refid="maven.dependency.classpath"/>
            <classpath location="${compiled.classes.dir}"/>
            <arg line="-o target/wsdl/rpcunwrapping -ss -sd -ssi -u  -g -uw -uri test-resources/wsdl/RPCUnwrappingTest.wsdl"/>
        </java>
        <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/wsdl/rpcunwrapping"/>

        <java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
			<classpath refid="maven.dependency.classpath"/>
			<arg line="-d xmlbeans -p samples.wsdl.perf -o target/perf -s -t -ss -sd -g -uri test/samples/wsdl/perf/perf.wsdl"/>
		</java>
		<ant:copy overwrite="yes" todir="target/perf/src/samples/wsdl/perf">
			<ant:fileset dir="test/samples/wsdl/perf">
				<ant:include name="*Skeleton.java"/>
			</ant:fileset>
		</ant:copy>
		<ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/perf"
				 target="make.repo"/>
		<ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/perf"
				 target="jar.client"/>
		 <ant:move file="target/perf/build/lib/Services-test-client.jar" 
			  tofile="target/perf/build/lib/PerfSoapService-test-client.jar" />
			  
		  <ant:move file="target/perf/build/lib/Services.aar" 
			  tofile="target/perf/build/lib/PerfSoapService.aar" />
			  
		 <ant:path id="samples.wsdl.perf.client.jar"
				  location="target/perf/build/lib/PerfSoapService-test-client.jar"/>
		
		<maven:addPath id="maven.dependency.classpath" refid="samples.wsdl.perf.client.jar"/>
		<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
			<classpath refid="maven.dependency.classpath"/>
			<arg line="-d adb -p samples.wsdl.perf2 -o target/perf2 -s -t -ss -sd -g -uri test/samples/wsdl/perf2/perf.wsdl"/>
		</java>
		<ant:copy overwrite="yes" todir="target/perf2/src/samples/wsdl/perf2">
			<ant:fileset dir="test/samples/wsdl/perf2">
				<ant:include name="*Skeleton.java"/>
			</ant:fileset>
		</ant:copy>
		<ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/perf2"
				 target="make.repo"/>
		<ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/perf2"
				 target="jar.client"/>
		<ant:move file="target/perf2/build/lib/Services-test-client.jar" 
				tofile="target/perf2/build/lib/PerfSoapService2-test-client.jar" />
		<ant:path id="samples.wsdl.perf2.client.jar"
				  location="target/perf2/build/lib/PerfSoapService2-test-client.jar"/>
		<maven:addPath id="maven.dependency.classpath" refid="samples.wsdl.perf2.client.jar"/>

		<!-- compile the schema for XMLbeans -->
		<java classname="org.apache.xmlbeans.impl.tool.SchemaCompiler" fork="true">
			<classpath refid="maven.dependency.classpath"/>
			<arg line="-src target/xmlbeans-src -d target/classes test-resources/xsd/type-test.xsd"/>
		</java>
	  
		<j:if test="${context.getVariable('skip.enterprise.tests') != 'true'}">	
		  <ant:echo>Running codegen RPC WSDLs - take 1</ant:echo>
		  <java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
			<classpath refid="maven.dependency.classpath"/>
				<arg line="-o target/rpc-test1 -uri test-resources/rpc/test-rpc-2.wsdl -uw"/>
		   </java>
		  <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/rpc-test1"
							 target="jar.client"/>
			  
			  <ant:echo>Running codegen RPC WSDLs - take 2</ant:echo>
		  <java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
			<classpath refid="maven.dependency.classpath"/>
				<arg line="-o target/rpc-test2 -uri test-resources/rpc/test-rpc-3.wsdl -uw"/>
		   </java>
		  <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/rpc-test2"
							 target="jar.client"/>
			  
		  
			  <ant:echo>Running codegen RPC WSDLs - take 3</ant:echo>
		  <java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
			<classpath refid="maven.dependency.classpath"/>
			<arg line="-o target/rpc-test3 -uri test-resources/rpc/test-rpc-2.wsdl -uw"/>
		   </java>
		  <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/rpc-test3"
							 target="jar.client"/>
			  
			   <ant:echo>Running codegen RPC WSDLs - take 4</ant:echo>
		  <java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
			<classpath refid="maven.dependency.classpath"/>
			<arg line="-o target/rpc-test4 -uri test-resources/rpc/test-rpc-2.wsdl -uw -ss -sd"/>
		   </java>
		  <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/rpc-test4"
							 target="jar.server"/>
	
			<ant:echo>Running codegen RPC WSDLs with helper mode -  take 1</ant:echo>
			<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
				<classpath refid="maven.dependency.classpath"/>
				<arg line="-o target/helper-test1 -uri test-resources/rpc/test-rpc-2.wsdl -u -Eh"/>
			</java>
			<ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/helper-test1"
					 target="jar.client"/>
	
			<ant:echo>Running codegen RPC WSDLs with helper mode -  take 2</ant:echo>
			<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
				<classpath refid="maven.dependency.classpath"/>
				<arg line="-o target/helper-test2 -uri test-resources/rpc/test-rpc-2.wsdl -u -Eh"/>
			</java>
			<ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/helper-test2"
					 target="jar.client"/>
	
			<j:if test="${context.getVariable('maven.test.skip') != 'true'}">
	
				<!-- codegen for the enterprise wsdl -->
				<ant:echo>Running codegen for Enterprise WSDL - take 1</ant:echo>
					<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
						<classpath refid="maven.dependency.classpath"/>
						<arg line="-d xmlbeans -o target/enterprise-test1 -s -uri test-resources/enterprise.wsdl"/>
					</java>
				 <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/enterprise-test1"
							 target="jar.client"/>
				<ant:echo>Running codegen for Enterprise WSDL - take 2</ant:echo>
					<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
						<classpath refid="maven.dependency.classpath"/>
						<arg line="-o target/enterprise-test2 -s -uri test-resources/enterprise.wsdl"/>
					</java>
				 <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/enterprise-test2"
							 target="jar.client"/>
			
				
				<ant:echo>Running codegen for Enterprise WSDL - take 3</ant:echo>
					<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
						<classpath refid="maven.dependency.classpath"/>
						<arg line="-d xmlbeans -ss -sd -g -o target/enterprise-test3 -s -uri test-resources/enterprise.wsdl"/>
					</java>
				 <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/enterprise-test3"
							 target="jar.server"/>
			
				<ant:echo>Running codegen for Enterprise WSDL - take 4</ant:echo>
					<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
						<classpath refid="maven.dependency.classpath"/>
						<arg line="-ns2p urn:sobject.enterprise.soap.sforce.com=com.salesforce -d xmlbeans -ss -sd -g -o target/enterprise-test4 -s -uri test-resources/enterprise.wsdl"/>
					</java>
				 <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/enterprise-test4"
							 target="jar.server"/>
				<ant:echo>Running codegen for eBaySvc WSDL</ant:echo>
					<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
						<classpath refid="maven.dependency.classpath"/>
						<arg line="-ss -sd -g -u -ssi -t -o target/eBaySvc -uri test-resources/eBaySvc.wsdl"/>
					</java>
				 <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/eBaySvc"
							 target="jar.server"/>
				<ant:echo>Running codegen for eBaySvc WSDL Back word compatibiliy</ant:echo>
					<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
						<classpath refid="maven.dependency.classpath"/>
						<arg line="-ss -sd -g -t -u -ssi -b -s -o target/eBaySvcB -uri test-resources/eBaySvc.wsdl"/>
					</java>
				 <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/eBaySvcB"
							 target="jar.server"/>
                <ant:echo>Running codegen for eBaySvc WSDL with un wrapping </ant:echo>
					<java classname="org.apache.axis2.wsdl.WSDL2Java" fork="true">
						<classpath refid="maven.dependency.classpath"/>
						<arg line="-ss -sd -ssi -u -g -t -uw  -o target/eBaySvcUW -uri test-resources/eBaySvc.wsdl"/>
					</java>
				 <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true" dir="target/eBaySvcUW"
							 target="jar.server"/>
            </j:if>
            <j:jelly xmlns="jelly:ant">
                <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true"
                         dir="test-resources/SOAP12Testing/SOAP12TestModuleB"/>
                <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true"
                         dir="test-resources/SOAP12Testing/SOAP12TestModuleC"/>
                <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true"
                         dir="test-resources/SOAP12Testing/SOAP12TestServiceB"/>
                <ant:ant antfile="build.xml" inheritall="true" inheritrefs="true"
                         dir="test-resources/SOAP12Testing/SOAP12TestServiceC"/>
            </j:jelly>
        </j:if>
    </preGoal>

    <postGoal name="test:compile">
        <j:if test="${context.getVariable('maven.test.skip') != 'true'}">
        	<ant:ant antfile="itest-build.xml" inheritall="true" inheritrefs="true"
        	                         dir="." target="build-repos"/>
        </j:if>
    </postGoal>
</project>

<?xml version="1.0" encoding="UTF-8"?>

<!-- $Revision: 1.21 $ $Date: 2004-10-27 20:54:09 +0600 (Wed, 27 Oct 2004) $ -->

<project default="jar"
         xmlns:j="jelly:core" 
         xmlns:u="jelly:util"
         xmlns:maven="jelly:maven"
         xmlns:util="jelly:util"
         xmlns:deploy="deploy"
         xmlns:ant="jelly:ant">

    <preGoal name="itest:compile">
        <u:file var="file" name="${maven.itest.src}"/>
        <j:if test="${!file.exists()}">
            <j:expr value="${context.setVariable('maven.itest.skip', 'true')}"/>
        </j:if>
    </preGoal>
	
	<preGoal name="test:test">
		<ant:copy toDir="target/test-classes/services/EchoService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="server/**"/>
			</ant:fileset>
			<ant:fileset dir="test/server">
				<ant:exclude name="**/*.java"/>
			</ant:fileset>
		</ant:copy>
        <!-- ================================================================ -->
        <!--- Provider endpoint Service Samples -->
        <!-- ================================================================ -->
		<ant:copy toDir="target/test-classes/services/StringProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/string/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/string">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
		<ant:copy toDir="target/test-classes/services/SourceProviderService/">
			<ant:fileset dir="target/test-classes">
				<ant:include name="org/apache/axis2/jaxws/provider/source/**"/>
			</ant:fileset>
			<ant:fileset dir="test/org/apache/axis2/jaxws/provider/source">
                <ant:include name="META-INF/**"/>
			</ant:fileset>
			<ant:fileset dir="target/classes">
                <ant:include name="org/apache/axis2/jaxws/server/**"/>
			</ant:fileset>
		</ant:copy>
	</preGoal>

    <!-- Create the API and Impl jars --> 
    <postGoal name="jar">
        <jar destfile="target/jaxws-api-${jaxws.version}.jar">
            <ant:fileset dir="target/classes">
            	<ant:exclude name="com/ibm/webservices/**"/>
            </ant:fileset>
        </jar>
    	<jar destfile="target/jaxws-impl-${jaxws.version}.jar">
    	    <ant:fileset dir="target/classes">
                <ant:exclude name="javax/**"/>
            </ant:fileset>
    	</jar>
        <ant:copy toDir="${maven.repo.local}/jaxws/jars">
            <ant:fileset file="target/jaxws-impl-${jaxws.version}.jar"/>
        	<ant:fileset file="target/jaxws-api-${jaxws.version}.jar"/>
        </ant:copy>
    </postGoal>

    <goal name="jar">
        <attainGoal name="jar:install"/>

    </goal>

    <goal name="release" prereqs="dist-bin,dist-src">


    </goal>

    <goal name="dist-bin" prereqs="jar">

        <ant:echo>+----------------------------------------------</ant:echo>
        <ant:echo>| Creating: JAXWS Binary Distribution</ant:echo>
        <ant:echo>+----------------------------------------------</ant:echo>


        <property name="dist" value="target/dist/temp"/>

        <mkdir dir="${dist}"/>
        <mkdir dir="${dist}/apidocs"/>
        <mkdir dir="${dist}/build"/>
        <!--<mkdir dir="${dist}/docs"/>-->
        <mkdir dir="${dist}/lib"/>

        <!--copy dependent jars-->
        <maven:reactor basedir="${basedir}"
                       postProcessing="true"
                       includes="project.xml"
                       banner="Executing (${goals}):"
                       ignoreFailures="false"/>
        <j:forEach var="x" items="${reactorProjects}">
            <ant:echo message="Copying ${x} to ${dist}"/>
            <deploy:copy-deps todir="${dist}/lib"
                              projectDescriptor="${x.getFile()}"/>
        </j:forEach>
        <ant:delete file="${dist}/lib/xmlunit-${xmlunit.version}.jar"/>

        <!--Add the licenses of jars-->
        <ant:copy toDir="${dist}/lib">
            <ant:fileset dir="legal"/>
        </ant:copy>

        <!--add api docs-->

        <ant:javadoc packagenames="org.apache.jaxws.*"
                     defaultexcludes="yes"
                     destdir="${dist}/apidocs"
                     author="true"
                     breakiterator="true"
                     version="true"
                     use="true"
                     windowtitle="JAXWS API">
            <ant:arg
                    line="-J-Dhttp.proxy.port=${maven.proxy.port} -J-Dhttp.proxy.host=${maven.proxy.host}"/>
            <ant:sourcepath>
                <ant:pathelement location="src"/>
            </ant:sourcepath>
            <ant:classpath>
                <ant:fileset dir="${dist}/lib">
                    <ant:include name="*.jar"/>
                </ant:fileset>
            </ant:classpath>
        </ant:javadoc>

        <!--add jars-->
        <ant:copy toDir="${dist}/build">
            <ant:fileset file="target/jaxws-api-${jaxws.version}.jar"/>
            <ant:fileset file="target/jaxws-impl-${jaxws.version}.jar"/>
        </ant:copy>

        <!--add documents-->
        <ant:copy toDir="${dist}/docs">
            <ant:fileset dir="xdocs">
                <ant:exclude name="**/.svn/**"/>
            </ant:fileset>
        </ant:copy>

        <!--copy release notes, etc-->
        <ant:copy toDir="${dist}">
            <ant:fileset file="RELEASE-NOTE.txt"/>
            <ant:fileset file="README.txt"/>
            <ant:fileset file="NOTICE.txt"/>
            <ant:fileset file="LICENSE.txt"/>
        </ant:copy>


        <!--create the zip-->
        <ant:zip file="target/dist/jaxws-${jaxws.version}-bin.zip">
            <ant:fileset dir="${dist}/"/>
        </ant:zip>

        <ant:delete dir="${dist}"/>

    </goal>

    <goal name="dist-src" prereqs="jar">

        <ant:echo>+----------------------------------------------</ant:echo>
        <ant:echo>| Creating: JAXWS Source Distribution</ant:echo>
        <ant:echo>+----------------------------------------------</ant:echo>

        <ant:property name="${dist}" value="target/dist/temp"/>

        <ant:copy toDir="${dist}">
            <ant:fileset dir=".">
                <ant:exclude name="**/.svn/**"/>
                <ant:include name="**/src/**"/>
                <ant:include name="**/test/**"/>
            </ant:fileset>
        </ant:copy>

        <!-- Copy the master maven files for the standard src distro -->
        <ant:copy toDir="${dist}">
            <ant:fileset file="maven.xml"/>
            <ant:fileset file="project.xml"/>
            <ant:fileset file="project.properties"/>
            <ant:fileset file="RELEASE-NOTE.txt"/>
            <ant:fileset file="NOTICE.txt"/>
            <ant:fileset file="LICENSE.txt"/>
        </ant:copy>

        <ant:zip file="target/dist/jaxws-${jaxws.version}-src.zip">
            <ant:fileset dir="${dist}/"/>
        </ant:zip>
        <ant:delete dir="${dist}"/>
    </goal>

    <goal name="javadocs">

        <mkdir dir="target/apidocs"/>

        <ant:javadoc packagenames="org.apache.jaxws.*"
                     defaultexcludes="yes"
                     destdir="target/apidocs"
                     author="true"
                     breakiterator="true"
                     version="true"
                     use="true"
                     windowtitle="JAXWS API">
            <ant:arg
                    line="-J-Dhttp.proxy.port=${maven.proxy.port} -J-Dhttp.proxy.host=${maven.proxy.host}"/>
            <ant:sourcepath>
                <ant:pathelement location="src"/>
            </ant:sourcepath>
        </ant:javadoc>
    </goal>

</project>

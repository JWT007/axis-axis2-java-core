<?xml version="1.0" encoding="UTF-8"?>
<project default="jar"
         xmlns:j="jelly:core"
         xmlns:u="jelly:util"
         xmlns:maven="jelly:maven"
         xmlns:deploy="deploy"
         xmlns:ant="jelly:ant">
    <j:set var="samples.dir" value="target/samples"/>

    <preGoal name="java:compile">
        <path id="samples.src.path">
            <pathelement location="version/src"/>
            <pathelement location="yahoorestsearch/src"/>
            <!-- we need groovy service for the tests in integration. 
             Later we can migrate this to integration-->
	    <pathelement location="deprecated/groovy/src"/>
        </path>
        <maven:addPath id="maven.compile.src.set" refid="samples.src.path"/>
    </preGoal>

    <postGoal name="test:test">
        <attainGoal name="create-samples"/>
    </postGoal>

    <goal name="create-samples">
        <mkdir dir="${samples.dir}/userguide"/>
        <mkdir dir="target/samples/wsdl"/>
        <copy todir="target/samples/wsdl">
            <ant:fileset dir="wsdl"/>
        </copy>
        <attainGoal name="userguide"/>
        <attainGoal name="googleSpellcheck"/>
        <attainGoal name="yahooRESTSearch"/>
        <attainGoal name="version"/>
        <attainGoal name="groovy"/>
    </goal>

    <!-- ================================================================ -->
    <!--- Version Sample -->
    <!-- ================================================================ -->
    <goal name="version">
        <mkdir dir="target/version" />
        <jar destfile="target/version/version.jar">
            <fileset dir="target/classes">
                <include name="sample/axisversion/**"/>
            </fileset>
            <fileset dir="version/src/sample/axisversion/">
                <include name="META-INF/services.xml"/>
            </fileset>
        </jar>
        <copy file="target/version/version.jar"
              tofile="target/toWar/services/version.aar"/>
    </goal>
    
    <!-- ================================================================ -->
    <!--- User Guide Sample -->
    <!-- ================================================================ -->
    <goal name="userguide">
        <mkdir dir="target/samples"/>
        <mkdir dir="${samples.dir}/userguide"/>
        <mkdir dir="${samples.dir}/userguide/src"/>
        <ant:copy todir="${samples.dir}/userguide/src">
            <ant:fileset dir="userguide/src">
                <ant:include name="userguide/**"/>
            </ant:fileset>
        </ant:copy>
        <jar destfile="${samples.dir}/userguide/sample.jar">
            <fileset dir="target/classes">
                <include name="userguide/**"/>
            </fileset>
        </jar>
    </goal>
 
    <goal name="yahooRESTSearch">
        <mkdir dir="target/yahoorestsearch" />
        <jar destfile="target/yahoorestsearch/yahooRESTSearch.jar">
            <fileset dir="target/classes">
                <include name="sample/yahooservices/RESTSearch/**"/>
            </fileset>
        </jar>
    </goal>

    <!-- ================================================================ -->
    <!--- Google SpellCheck Sample -->
    <!-- ================================================================ -->

    <goal name="googleSpellcheck">
        <mkdir dir="target/googlespellcheck" />
        <jar destfile="target/googlespellcheck/googleSpellcheck.jar">
            <fileset dir="target/classes">
                <include name="sample/google/spellcheck/**"/>
                <include name="sample/google/common/**"/>
            </fileset>
        </jar>
    </goal>

    <!-- ================================================================ -->
    <!--- Groovy Service Sample -->
    <!-- ================================================================ -->

    <goal name="groovy">
        <mkdir dir="target/groovy"/>
        <ant:copy file="deprecated/groovy/src/sample/groovy/GroovyRcv.groovy"
                  tofile="target/classes/sample/groovy/GroovyRcv.groovy"/>
        <mkdir dir="target/classes/sample/groovy/lib"/>
        <mkdir dir="target/classes/sample/groovy/META-INF"/>
        <mkdir dir="target/classes/sample/groovy/sample"/>
        <mkdir dir="target/classes/sample/groovy/sample/groovy"/>
        <ant:copy file="target/classes/sample/groovy/GroovyReceiver.class"
                  tofile="target/classes/sample/groovy/sample/groovy/GroovyReceiver.class"/>
        <ant:copy file="deprecated/groovy/src/sample/groovy/META-INF/services.xml"
                  tofile="target/classes/sample/groovy/META-INF/services.xml"/>
        <ant:delete file="target/classes/sample/groovy/GroovyReceiver.class"/>
        <j:if test="${context.getVariable('maven.jar.override').toString().trim().equalsIgnoreCase('on')}">
            <ant:copy file="${dependencies.dir}/groovy-all-${groovy.all.version}.jar"
                      tofile="target/classes/sample/groovy/lib/groovy-all-${groovy.all.version}.jar"/>
        </j:if>
        <j:if test="${context.getVariable('maven.jar.override').toString().trim().equalsIgnoreCase('off')}">
            <ant:copy file="${maven.repo.local}/groovy/jars/groovy-all-${groovy.all.version}.jar"
                      tofile="target/classes/sample/groovy/lib/groovy-all-${groovy.all.version}.jar"/>
        </j:if>
        <jar destfile="target/groovy/groovyService.aar">
            <fileset dir="target/classes/sample/groovy">
            </fileset>
        </jar>
    </goal>
 
</project>
